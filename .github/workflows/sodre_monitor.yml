name: SodrÃ© Santoro Monitor

on:
  schedule:
    # Executa a cada 4 horas
    - cron: '0 */4 * * *'
  workflow_dispatch:
    inputs:
      debug:
        description: 'Enable debug mode'
        required: false
        default: 'false'

env:
  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
  SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
  PYTHONUNBUFFERED: '1'  # Logs em tempo real

jobs:
  monitor-sodre:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ğŸ”µ Checkout cÃ³digo
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          python -m pip install --upgrade pip
          pip install playwright supabase-py
          playwright install chromium
          playwright install-deps chromium
      
      - name: ğŸš€ Executar Monitor SodrÃ© Santoro
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”µ INICIANDO MONITOR SODRÃ‰ SANTORO"
          echo "â° $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          python scraper/sodre_monitor.py
        continue-on-error: false
      
      - name: ğŸ“Š Upload logs (em caso de erro)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: sodre-monitor-logs-${{ github.run_number }}
          path: |
            *.log
            *.txt
          retention-days: 7
      
      - name: âœ… FinalizaÃ§Ã£o
        if: always()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ Monitor SodrÃ© Santoro finalizado"
          echo "â° $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ“Š Status: ${{ job.status }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"